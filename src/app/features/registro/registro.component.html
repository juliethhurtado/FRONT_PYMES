<div class="background">
  <div class="container-formulario">

<!-- Introducci√≥n -->
<div class="text-center mb-4">
  <h1 class="titulo-sade borde-skyblue">SADE</h1>
  <h5 style="font-size: 1.25rem; font-weight: 700; color: #000;">Sistema de Autoevaluaci√≥n Digital para Empresas</h5>
  <img src="assets/images/pymes.jpg" alt="Logo PYMES" class="img-fluid my-3" style="max-height: 200px;">
</div>


    <!-- MINI MANUAL DE USUARIO -->
    <div *ngIf="mostrarManual" class="card p-4 mb-4">
      <h4 class="text-center mb-4">Herramienta de Evaluaci√≥n de Madurez Tecnol√≥gica en PYMEs</h4>

      <div class="mb-3">
        <h5>üîπ Paso 1. Registro Inicial</h5>
        <p>Completa el formulario con tus datos b√°sicos: Informaci√≥n personal y laboral, detalles de la empresa, y aceptaci√≥n del uso de datos con fines acad√©micos. <strong>Tu informaci√≥n ser√° tratada con confidencialidad.</strong></p>
      </div>

      <div class="mb-3">
        <h5>üîπ Paso 2. Introducci√≥n al Modelo</h5>
        <p>Conoce el Modelo de Madurez para la Adopci√≥n de Tecnolog√≠as 4.0 validado por expertos, que te permite identificar el estado tecnol√≥gico de tu empresa.</p>
      </div>

      <div class="mb-3">
        <h5>üîπ Paso 3. Cuestionario de Evaluaci√≥n</h5>
        <p>Responde 22 preguntas en escala Likert (1 a 5) agrupadas en 5 dimensiones:</p>
        <ul>
          <li>Estrategia y liderazgo digital</li>
          <li>Tecnolog√≠as clave</li>
          <li>Capital humano</li>
          <li>Gesti√≥n del conocimiento</li>
          <li>Cultura organizacional</li>
        </ul>
        <p>Escala:</p>
        <ul>
          <li>1 = No se aplica</li>
          <li>2 = Se est√° explorando</li>
          <li>3 = Se aplica parcialmente</li>
          <li>4 = Se aplica con frecuencia</li>
          <li>5 = Se aplica completamente</li>
        </ul>
      </div>

      <div class="mb-3">
        <h5>üîπ Paso 4. Resultados y Recomendaciones</h5>
        <p>Recibir√°s tu porcentaje de madurez, nivel alcanzado y un mensaje personalizado con recomendaciones.</p>
        <table class="table table-bordered">
          <thead class="table-light">
            <tr>
              <th>Nivel</th>
              <th>Porcentaje</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>1</td><td>0% ‚Äì 20%</td><td>Inicial</td></tr>
            <tr><td>2</td><td>21% ‚Äì 40%</td><td>Exploratorio</td></tr>
            <tr><td>3</td><td>41% ‚Äì 60%</td><td>En transici√≥n</td></tr>
            <tr><td>4</td><td>61% ‚Äì 80%</td><td>Integrado</td></tr>
            <tr><td>5</td><td>81% ‚Äì 100%</td><td>Avanzado / Transformador</td></tr>
          </tbody>
        </table>
      </div>

      <div class="mb-3">
        <h5>üîπ Paso 5. Compartir resultado</h5>
        <p>Al finalizar, tu resultado ser√° enviado por correo electr√≥nico al email registrado.</p>
      </div>

      <div class="mb-3">
        <h5>Panel Global (opcional)</h5>
        <p>Los administradores podr√°n visualizar estad√≠sticas globales y fichas de resultados a nivel agregado.</p>
      </div>

      <p class="text-muted text-center mt-4">
        <em>Completa el cuestionario con sinceridad para obtener un diagn√≥stico √∫til y recomendaciones personalizadas.</em>
      </p>

      <div class="text-center mt-4">
        <button class="btn btn-primary btn-lg px-5" (click)="iniciarRegistro()">Iniciar</button>
      </div>
    </div>

    <!-- PASO 1: Registro -->
    <div *ngIf="!mostrarManual && pasoActual === 1">
      <h1 class="titulo-principal text-center">REGISTRO DE EMPRESA</h1>
      <form [formGroup]="empresaForm" (ngSubmit)="continuarCuestionario()" class="card p-4 shadow">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Nombre de la empresa</label>
            <input class="form-control" formControlName="nombreEmpresa">
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Responsable</label>
            <input class="form-control" formControlName="responsable">
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Cargo</label>
            <input class="form-control" formControlName="cargo">
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Correo</label>
            <input type="email" class="form-control" formControlName="correo">
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Nombre del participante</label>
            <input class="form-control" formControlName="nombreParticipante">
          </div>

          <div class="col-md-3 mb-3">
            <label class="form-label">Edad</label>
            <input type="number" class="form-control" formControlName="edad">
          </div>

          <div class="col-md-3 mb-3">
            <label class="form-label">G√©nero</label>
            <select class="form-select" formControlName="genero">
              <option value="">Seleccione</option>
              <option value="Masculino">Masculino</option>
              <option value="Femenino">Femenino</option>
              <option value="Otro">Otro</option>
            </select>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Ciudad</label>
            <input class="form-control" formControlName="ciudad">
          </div>

          <div class="col-md-3 mb-3">
            <label class="form-label">N√∫mero de empleados</label>
            <input type="number" class="form-control" formControlName="numEmpleados">
          </div>

          <div class="col-md-3 mb-3">
            <label class="form-label">A√±os de experiencia</label>
            <input type="number" class="form-control" formControlName="experiencia">
          </div>
        </div>

        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" formControlName="aceptoParticipar" id="acepto">
          <label class="form-check-label" for="acepto">Acepto participar</label>
        </div>

        <div class="text-center">
          <button class="btn btn-primary px-4" type="submit">Continuar con el cuestionario</button>
        </div>
      </form>
    </div>

    <!-- PASO 2: Cuestionario con bloques de 4 preguntas -->
<div *ngIf="pasoActual === 2 && !mostrarResultado">
  <h2 class="mb-4 text-center">Cuestionario de Evaluaci√≥n</h2>

  <form [formGroup]="cuestionarioForm" (ngSubmit)="finalizarCuestionario()" class="card p-4 shadow">
    <div formArrayName="respuestas">
      <div *ngFor="let i of preguntasPorBloque()" class="mb-4">
        <label class="form-label d-block">{{ i + 1 }}. {{ preguntas[i] }}</label>
        <div class="d-flex gap-3">
          <ng-container *ngFor="let valor of [1, 2, 3, 4, 5]">
            <input
              type="radio"
              [value]="valor"
              [formControl]="getControl(i)"
              [id]="'preg_' + i + '_' + valor"
              name="pregunta_{{ i }}"
              class="form-check-input me-1"
            />
            <label class="form-check-label me-2" [for]="'preg_' + i + '_' + valor">
              {{ valor }}
            </label>
          </ng-container>
        </div>
      </div>
    </div>

    <div class="text-center mt-4">
      <button type="button" class="btn btn-outline-secondary me-2"
              (click)="anteriorBloque()" [disabled]="bloqueActual === 0">
        Anterior
      </button>

      <button *ngIf="bloqueActual < totalBloques - 1"
              type="button"
              class="btn btn-primary"
              (click)="siguienteBloque()">
        Siguiente
      </button>

      <button *ngIf="bloqueActual === totalBloques - 1"
              type="submit"
              class="btn btn-success">
        Finalizar Cuestionario
      </button>
    </div>
  </form>
</div>


    <!-- PASO 3: Resultados -->
<div *ngIf="mostrarResultado">
  <h2 class="text-center mb-4">Resultado del Diagn√≥stico de Transformaci√≥n Digital</h2>

 <!-- Nivel y mensaje -->
<div class="card p-4 shadow my-4">
  <h4 class="text-center text-primary">Nivel {{ nivelMadurez }} - {{ nivelNombre }}</h4>
  <p class="text-center mb-0">{{ nivelMensajeDetalle }}</p>
</div>


  <!-- Gr√°ficos -->
  <div class="row justify-content-center">
    <div class="col-md-10">
      <canvas baseChart
              [data]="barChartData"
              type="bar"
              [options]="barChartOptions"
              class="mb-4">
      </canvas>
    </div>
    <div class="col-md-6">
      <canvas baseChart
              [data]="pieChartData"
              type="pie">
      </canvas>
    </div>
  </div>

  <!-- Botones -->
  <div class="text-center mt-3">
    <button class="btn btn-outline-secondary ms-2" (click)="reiniciar()">Volver a empezar</button>
  </div>
</div>

